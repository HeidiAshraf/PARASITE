<section class="content profile-page">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <div class="block-header">
    <div class="row">
      <div class="col-lg-7 col-md-6 col-sm-12">
        <h2>{{ 'ACTIVITIES.LIST.ACTIVITY' | translate }}
          <small>{{ 'ACTIVITIES.DETAIL.WELCOME_MESSAGE' | translate }}</small>
        </h2>
      </div>
      <div class="col-lg-5 col-md-6 col-sm-12">
        <button [style.transform]="translate.currentLang === 'ara'? 'scaleX(-1)': null" class="btn btn-primary btn-icon btn-round hidden-sm-down float-right m-l-10" type="button" *ngIf="isCreator && !isBooked"
          (click)="openDialog()">
          <i class="zmdi zmdi-edit"></i>
        </button>
        <button class="btn btn-primary btn-icon btn-round hidden-sm-down float-right m-l-10" type="button" *ngIf="(isCreator || currentUser.isAdmin) && !isBooked"
          (click)="deleteActivity(activity)">
          <i class="zmdi zmdi-delete"></i>
        </button>
        <ul class="breadcrumb float-md-right">
          <li class="breadcrumb-item">
            <a routerLink="/dashboard">
              <i class="zmdi zmdi-home"></i> Dasboard</a>
          </li>
          <li class="breadcrumb-item">
            <a routerLink="/activities">
              <i class="zmdi zmdi-home"></i> {{ 'ACTIVITIES.LIST.ACTIVITIES' | translate }}</a>
          </li>
          <li class="breadcrumb-item active">{{activity.name}}</li>
        </ul>
      </div>
    </div>
  </div>
  <!--Activity Container -->
  <div class="container-fluid">
    <div class="row clearfix">
      <div class="col-lg-12 col-md-12">
        <div class="card profile-header bg-dark">
          <div class="body col-white">
            <div class="row">
              <div class="col-lg-3 col-md-4 col-12">
                <div class="profile-image float-md-right">
                  <img [src]="activity.image" alt=""> </div>
                  <a *ngIf="isCreator && !isBooked" href="#defaultModal" data-toggle="modal" data-target="#defaultModal" title="Change picture" style="float:right">
                    <i class="zmdi zmdi-edit"></i>
                  </a>
              </div>
              <div class="col-lg-9 col-md-8 col-12">
                <h4 class="m-t-0 m-b-0">{{activity.name}}</h4>
                <span class="job_post">{{ 'ACTIVITIES.LIST.ACTIVITY' | translate }}</span>
                <p>{{ 'ACTIVITIES.DETAIL.FROM' | translate }} : {{activity.fromDateTime | date:'yyyy-MM-dd HH:mm': 'locale'}}
                  {{ 'ACTIVITIES.DETAIL.TO' | translate }} : {{activity.toDateTime | date:'yyyy-MM-dd HH:mm': 'locale'}}</p>
                <div>
                  <span style="color: #ff5722; margin-right: 4px">{{ activity.price | currency: 'EGP'}}</span>
                  <button class="btn btn-primary btn-round btn-simple">{{ 'ACTIVITIES.DETAIL.COMMENT' | translate }}</button>
                  <div *ngIf="signedIn && !currentUser.isChild">
                    <button class="btn btn-primary btn-round" [disabled]="!bookingUser" (click)="bookActivity()">{{ 'ACTIVITIES.DETAIL.BOOK_FOR' | translate }}</button>
                    <select class="form-control-sm form-control btn-primary col-sm-2" [(ngModel)]="bookingUser">
                      <option *ngFor="let user of canBookFor" [ngValue]="user">{{user}}</option>
                    </select>
                  </div>
                </div>
                <p class="social-icon m-t-5 m-b-0"></p>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--....................-->
  <!--Activity Description-->
  <div class="col-lg-12 col-md-12">
    <div class="card">
      <div class="body">
        <h4>{{ 'ACTIVITIES.DETAIL.DESCRIPTION' | translate }}</h4>
        {{activity.description}}
      </div>
    </div>
    <!--...................-->
  </div>

  <div class="container-fluid mb-0">
    <div class="row clearfix">
      <div class="col-lg-12">
        <div class="card">
          <div class="body">
            <ul class="cbp_tmtimeline  mt-3">
              <!--The part responsible for commenting-->
              <li *ngIf="signedIn" id="target">
                <time class="cbp_tmtime" style="width: 20%;" datetime="2017-11-04T18:30">
                  <span class="large mt-2">Now</span>
                </time>
                <div class="cbp_tmicon bg-white">
                  <img class="media-object rounded-circle" [src]="currentUser.avatar || defaultPP" alt="">
                </div>
                <div class="cbp_tmlabel empty">
                  <span>
                    <div class="form-group  w-80">
                      <input type="text" class="form-control" id="inputArea" placeholder={{somePlaceholder}} #commentInput [(ngModel)]="changingComment">
                    </div>
                  </span>
                  <div align="end">
                    <span>
                      <span *ngIf="!isReplying; else elseTemplate">
                        <button class="btn btn-raised btn-primary waves-effect btn-round col-white" (disabled)="changingComment == ''" (click)="addComment(commentInput.value)">
                          {{ 'ACTIVITIES.DETAIL.COMMENT' | translate }}
                        </button>
                      </span>
                        <ng-template #elseTemplate>
                          <button class="btn btn-raised btn-primary waves-effect btn-round col-white" (disabled)="changingComment == ''" (click)="addComment(commentInput.value)">
                            {{ 'ACTIVITIES.DETAIL.REPLY' | translate }}
                          </button>
                        </ng-template>
                      <button type="button" class="btn btn-icon btn-icon-mini btn-round btn-primary" data-toggle="tooltip" data-placement="bottom"
                        title="Cancel" (click)="cancelReplying()">
                        <i class="zmdi zmdi-close zmdi-hc-lg"></i>
                      </button>
                    </span>
                  </div>
                </div>
              </li>
              <!--.....................-->
              <!--The Part responsible for comments-->
              <li *ngFor="let comment of activity.discussion; let i = index">
                <time style="width: 20%;" class="cbp_tmtime" datetime="2017-11-04T03:45">
                  <span class="mt-2">{{comment.createdAt*1000 | date:'MM/dd/yyyy HH:mm': 'locale'}}</span>
                </time>
                <div class="cbp_tmicon bg-white">
                  <img class="media-object bg-white rounded-circle" *ngIf="comment.creatorInfo" [src]="comment.creatorInfo.avatar || defaultPP">
                  <i class="zmdi zmdi-label"></i>
                </div>
                <div class="cbp_tmlabel">
                  <div class="row">
                    <div class="col-md-6 ">
                      <div class="inner-content">
                        <h2>
                          <a href="profile/{{comment.creator}}">{{comment.creator}}</a>
                        </h2>
                      </div>
                    </div>
                    <div class="col-md-6" align="end">
                      <div class="inner-content">
                        <span>
                          <button type="button" class="btn btn-icon btn-icon-mini btn-round btn-primary" *ngIf="comment.replies.length > 0" (click)="showReply(i)"
                            data-toggle="tooltip" data-placement="bottom" title={{(viewedReplies[i])?hideReplies:showReplies}}>
                            <i *ngIf="!viewedReplies[i]" class="zmdi zmdi-triangle-down"></i>
                            <i *ngIf="viewedReplies[i]" class="zmdi zmdi-triangle-up"></i>

                          </button>
                          <button type="button" class="btn btn-icon btn-icon-mini btn-round btn-primary" (click)="onReply(comment._id)" data-toggle="tooltip"
                            data-placement="bottom" title="Reply">
                            <i class="zmdi zmdi-mail-reply"></i>
                          </button>
                          <button type="button" class="btn btn-icon btn-icon-mini btn-round btn-danger" *ngIf="(comment.creator === currentUser.username || currentUser.isAdmin || currentUser.username === activity.creator )"
                            (click)="onDelete(comment._id)" data-toggle="tooltip" data-placement="bottom" title="Delete Comment">
                            <i class="zmdi zmdi-delete "></i>
                          </button>
                        </span>
                      </div>
                    </div>
                    <div class="text-muted ml-4">
                      <p>{{comment.text}} </p>
                    </div>
                  </div>
                  <!--the part responsible for replies-->
                  <br/>
                  <div>
                  <div class="mail_list list-group list-unstyled" *ngIf="viewedReplies[i]" style="margin-left: 10%">
                    <div style="padding-left: 0px; margin-left: 0px;" *ngFor="let reply of comment.replies; let j = index">
                      <!--<div class="row">-->

                        <div class="col-md-12 row">

                          <div style="width: 35px; height: 35px;">
                            <img style="width: 100%; height: 100%" class="rounded-circle" *ngIf="comment.creatorInfo" [src]="comment.creatorInfo.avatar || defaultPP">
                          </div>
                          <div class="ml-3 mr-auto">
                            <h2><a href="profile/{{comment.creator}}">{{reply.creator}}</a></h2>
                          </div>
                          <div>
                            <button type="button" class="btn btn-icon btn-round btn-danger btn-xs" *ngIf="reply.creator === currentUser.username || comment.creator === currentUser.username || currentUser.isAdmin || currentUser.username === content.creator"
                                  (click)="onDeleteReply(comment._id,reply._id)" data-toggle="tooltip" data-placement="bottom"
                                  title="Delete Reply">
                              <i class="zmdi zmdi-delete"></i>
                            </button>
                          </div>
                        </div>
                      <p style = "float: right" class="ml-3 text-muted" style="margin-left: 10% !important;">{{reply.text}}</p>

                      <div *ngIf=" j != comment.replies.length-1">
                        <hr />
                      </div>
                    </div>
                  </div>
                  </div>
                  <!--................................-->
                </div>
                <div>

                </div>
              </li>
              <!--....................................-->
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<section>
  <div class="modal fade" id="defaultModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="title" id="defaultModalLabel">{{ 'ACTIVITIES.EDIT.ACTIVITY_IMAGE' | translate }}</h4>
        </div>
        <div class="modal-body">
          <app-image-uploader (ImageUploaded)="uploaded($event)"></app-image-uploader>
          <button id="closeModal" type="button" class="btn btn-danger btn-simple btn-round waves-effect" data-dismiss="modal" style="float:right">{{ 'ACTIVITIES.EDIT.CANCEL' | translate }}</button>
        </div>
      </div>
    </div>
  </div>
</section>
